---
title: "project1.Rmd"
output: html_document
---

XXX

```{r}
library(caret)
library(doMC)
registerDoMC(cores = 4)
set.seed(42)
```
Load files, making sure to set empty strings to NA (there are a lot of them).
```{r}
pmlTrainRaw<-read.csv("pml-training.csv",na.strings=c("NA",""))
pmlTest<-read.csv("pml-testing.csv",na.strings=c("NA",""))
```
First seven rows have metadata for the rows, which is unlikely to help our model (unless perhaps one particular person gets hurt more than others...).  Additionally, columns either have a large number of NAs or zero, so stick to the complete ones.
```{r}
pmlTrainRaw<-pmlTrainRaw[,8:160]
pmlTest<-pmlTest[,8:160]

nona<-apply(is.na(pmlTrainRaw),2,sum)==0
pmlTrainRaw<-pmlTrainRaw[,nona]
pmlTest<-pmlTest[,nona]
```
Separate out a validation set so that we don't pollute the test set.  To determine the final answers, we used a 75/25 training/validation set split, however to keep the runtime short when creating markdown we returned it to 10/90.
```{r}
inTrain<-createDataPartition(pmlTrainRaw$classe,p=0.1,list=FALSE)
pmlTrain<-pmlTrainRaw[inTrain,]
pmlValidate<-pmlTrainRaw[-inTrain,]
```

First let's try a decision tree.  This is likely insufficient, but makes a good baseline.
```{r}
modFitDt<-train(classe ~ .,data=pmlTrain,method="rpart")

predTrain<-predict(modFitDt,newdata=pmlTrain)
confusionMatrix(predTrain,pmlTrain$classe)$overall[1]

predValidate<-predict(modFitDt,newdata=pmlValidate)
confusionMatrix(predValidate,pmlValidate$classe)$overall[1]
```

Next we can try LDA.
```{r}
modFitDt<-train(classe ~ .,data=pmlTrain,method="lda")

predTrain<-predict(modFitDt,newdata=pmlTrain)
confusionMatrix(predTrain,pmlTrain$classe)$overall[1]

predValidate<-predict(modFitDt,newdata=pmlValidate)
confusionMatrix(predValidate,pmlValidate$classe)$overall[1]
```

Random forest is the most reliable
```{r}
modFitRf<-train(classe ~ .,data=pmlTrain,method="rf")

predTrain<-predict(modFitRf,newdata=pmlTrain)
confusionMatrix(predTrain,pmlTrain$classe)$overall[1]

predValidate<-predict(modFitRf,newdata=pmlValidate)
confusionMatrix(predValidate,pmlValidate$classe)$overall[1]
```
predTest<-predict(modFitRf,newdata=pmlTest)
predTest
